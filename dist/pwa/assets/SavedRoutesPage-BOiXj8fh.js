import{a as G,a$ as K,N as Z,g as ee,O as te,b0 as oe,d as h,h as D,A as ae,a2 as se,u as N,o as Y,z as re,a0 as ne,a1 as ie,ae as x,a4 as d,a6 as s,a7 as i,af as O,a3 as B,a5 as o,ab as m,ag as _,aa as g,ac as L,ad as P,ay as U,a8 as le,a9 as ce,az as J,C as W,ah as H}from"./index-CVLa6XA6.js";import{Q as ue}from"./QTooltip-CVYWUGtE.js";import{Q as de}from"./QBanner-BqSWA4dk.js";import{Q as T}from"./QChip-Dv5YEZnZ.js";import{u as fe,Q as V,a as Q}from"./use-quasar-CiN8XqRT.js";import{Q as ve}from"./QList-CPj_Flq7.js";import{Q as me}from"./QBtnDropdown-MwbGpetn.js";import{Q as ge}from"./QPage-C6cDZTbj.js";import{C as j}from"./ClosePopup-C0MrLjBC.js";import"./position-engine-DIrHBH4j.js";import"./selection-c1DTHd5y.js";import"./QMenu-CzybAdUr.js";const he={xs:2,sm:4,md:6,lg:10,xl:14};function X(t,p,r){return{transform:p===!0?`translateX(${r.lang.rtl===!0?"-":""}100%) scale3d(${-t},1,1)`:`scale3d(${t},1,1)`}}const pe=G({name:"QLinearProgress",props:{...Z,...K,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(t,{slots:p}){const{proxy:r}=ee(),y=te(t,r.$q),q=oe(t,he),S=h(()=>t.indeterminate===!0||t.query===!0),w=h(()=>t.reverse!==t.query),I=h(()=>({...q.value!==null?q.value:{},"--q-linear-progress-speed":`${t.animationSpeed}ms`})),f=h(()=>"q-linear-progress"+(t.color!==void 0?` text-${t.color}`:"")+(t.reverse===!0||t.query===!0?" q-linear-progress--reverse":"")+(t.rounded===!0?" rounded-borders":"")),k=h(()=>X(t.buffer!==void 0?t.buffer:1,w.value,r.$q)),v=h(()=>`with${t.instantFeedback===!0?"out":""}-transition`),C=h(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${v.value} q-linear-progress__track--${y.value===!0?"dark":"light"}`+(t.trackColor!==void 0?` bg-${t.trackColor}`:"")),R=h(()=>X(S.value===!0?1:t.value,w.value,r.$q)),$=h(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${v.value} q-linear-progress__model--${S.value===!0?"in":""}determinate`),e=h(()=>({width:`${t.value*100}%`})),n=h(()=>`q-linear-progress__stripe absolute-${t.reverse===!0?"right":"left"} q-linear-progress__stripe--${v.value}`);return()=>{const c=[D("div",{class:C.value,style:k.value}),D("div",{class:$.value,style:R.value})];return t.stripe===!0&&S.value===!1&&c.push(D("div",{class:n.value,style:e.value})),D("div",{class:f.value,style:I.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":t.indeterminate===!0?void 0:t.value},ae(p.default,c))}}});function ye(){const t=se(),p=N(navigator.onLine),r=N([]),y=()=>{p.value=navigator.onLine,p.value&&r.value.length>0&&C()},q=h(()=>t.isPremium&&!p.value),S=async e=>{if(!t.isPremium)return!1;try{const n=JSON.parse(localStorage.getItem("cachedRoutes")||"[]"),c=n.findIndex(b=>b.id===e.id);return c>=0?n[c]={...e,cachedAt:new Date().toISOString()}:n.push({...e,cachedAt:new Date().toISOString()}),n.length>50&&(n.sort((b,E)=>new Date(E.cachedAt)-new Date(b.cachedAt)),n.length=50),localStorage.setItem("cachedRoutes",JSON.stringify(n)),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_ROUTE",payload:e}),!0}catch(n){return console.error("Error caching route:",n),!1}},w=()=>{try{return JSON.parse(localStorage.getItem("cachedRoutes")||"[]")}catch(e){return console.error("Error getting cached routes:",e),[]}},I=e=>w().find(c=>c.id===e),f=e=>{try{const c=w().filter(b=>b.id!==e);return localStorage.setItem("cachedRoutes",JSON.stringify(c)),!0}catch(n){return console.error("Error removing cached route:",n),!1}},k=()=>{try{return localStorage.removeItem("cachedRoutes"),!0}catch(e){return console.error("Error clearing cached routes:",e),!1}},v=e=>{r.value.push({...e,timestamp:Date.now()}),localStorage.setItem("offlineQueue",JSON.stringify(r.value))},C=async()=>{const e=[...r.value];for(const n of e)try{n.type==="favorite"&&await fetch(n.url,{method:n.method,body:JSON.stringify(n.data),headers:{"Content-Type":"application/json"}}),r.value=r.value.filter(c=>c.timestamp!==n.timestamp)}catch(c){console.error("Error processing offline request:",c)}localStorage.setItem("offlineQueue",JSON.stringify(r.value))},R=async()=>{if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{usage:e.usage,quota:e.quota,usageInMB:(e.usage/(1024*1024)).toFixed(2),quotaInMB:(e.quota/(1024*1024)).toFixed(2),percentageUsed:(e.usage/e.quota*100).toFixed(2)}}return null},$=async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/service-worker.js");return console.log("Service Worker registered:",e),e}catch(e){return console.error("Service Worker registration failed:",e),null}return null};return Y(()=>{window.addEventListener("online",y),window.addEventListener("offline",y);try{const e=localStorage.getItem("offlineQueue");e&&(r.value=JSON.parse(e))}catch(e){console.error("Error loading offline queue:",e)}$()}),re(()=>{window.removeEventListener("online",y),window.removeEventListener("offline",y)}),{isOnline:p,canUseOffline:q,offlineQueue:r,cacheRouteData:S,getCachedRoutes:w,getCachedRoute:I,removeCachedRoute:f,clearAllCachedRoutes:k,queueForOnline:v,getCacheSize:R,registerServiceWorker:$}}const _e={class:"row justify-center"},we={class:"col-12 col-md-10 col-lg-8"},xe={class:"row items-center q-mb-md"},Se={class:"col"},ke={class:"text-h5 text-weight-bold"},be={class:"text-caption text-grey-7"},qe={class:"col-auto"},Ce={key:2,class:"q-gutter-md"},Re={class:"row items-start"},$e={class:"col"},Qe={class:"text-h6 text-weight-medium q-mb-xs"},Ie={class:"text-body2 text-grey-7 q-mb-sm"},Oe={class:"row q-gutter-xs"},Be={class:"col-auto"},Ne={class:"text-caption text-grey-7"},ze={class:"q-mb-xs"},Ae={class:"q-mb-xs"},Me={key:0},De={key:3,class:"q-mt-lg text-center"},Ee={key:0},Fe={class:"absolute-full flex flex-center"},Le={class:"text-white text-caption"},Pe={class:"text-caption text-grey-7"},Ue={__name:"SavedRoutesPage",setup(t){const p=ie(),r=fe(),{isOnline:y,getCachedRoutes:q,removeCachedRoute:S,clearAllCachedRoutes:w,getCacheSize:I}=ye(),f=N([]),k=N(!1),v=N(null);Y(async()=>{await C(),await R()});const C=async()=>{k.value=!0;try{f.value=q()}catch{r.notify({type:"negative",message:"Failed to load saved routes",position:"top"})}finally{k.value=!1}},R=async()=>{v.value=await I()},$=async()=>{await C(),await R(),r.notify({type:"positive",message:"Routes refreshed",position:"top"})},e=u=>{p.push(`/route/${u.id}`)},n=async u=>{if(navigator.share)try{await navigator.share({title:u.name,text:u.description,url:window.location.origin+`/route/${u.id}`})}catch{console.log("Share cancelled")}else{const a=window.location.origin+`/route/${u.id}`;await navigator.clipboard.writeText(a),r.notify({type:"positive",message:"Route link copied to clipboard",position:"top"})}},c=u=>{r.dialog({title:"Remove Route",message:`Remove "${u.name}" from saved routes?`,cancel:!0,persistent:!0}).onOk(()=>{S(u.id)?(f.value=f.value.filter(l=>l.id!==u.id),r.notify({type:"positive",message:"Route removed",position:"top"})):r.notify({type:"negative",message:"Failed to remove route",position:"top"})})},b=()=>{r.dialog({title:"Clear All Routes",message:"This will remove all cached routes. Continue?",cancel:!0,persistent:!0,ok:{color:"negative",label:"Clear All"}}).onOk(()=>{w()?(f.value=[],r.notify({type:"positive",message:"All routes cleared",position:"top"})):r.notify({type:"negative",message:"Failed to clear routes",position:"top"})})},E=u=>{const a=new Date(u),z=new Date-a,A=Math.floor(z/6e4);if(A<1)return"Just now";if(A<60)return`${A} min ago`;const M=Math.floor(A/60);if(M<24)return`${M} hour${M>1?"s":""} ago`;const F=Math.floor(M/24);return F<7?`${F} day${F>1?"s":""} ago`:a.toLocaleDateString()};return(u,a)=>(d(),x(ge,{class:"q-pa-md"},{default:s(()=>[i("div",_e,[i("div",we,[i("div",xe,[i("div",Se,[i("div",ke,[o(_,{name:"bookmark",color:"primary",size:"28px",class:"q-mr-sm"}),a[1]||(a[1]=m(" Saved Routes ",-1))]),i("div",be,g(L(y)?"Online":"Offline Mode")+" â€¢ "+g(f.value.length)+" routes cached ",1)]),i("div",qe,[o(P,{flat:"",round:"",icon:"refresh",onClick:$,loading:k.value},{default:s(()=>[o(ue,null,{default:s(()=>[...a[2]||(a[2]=[m("Refresh",-1)])]),_:1})]),_:1},8,["loading"])])]),L(y)?O("",!0):(d(),x(de,{key:0,class:"bg-warning text-white q-mb-md",rounded:""},{avatar:s(()=>[o(_,{name:"cloud_off"})]),default:s(()=>[a[3]||(a[3]=m(" You're offline. Showing cached routes only. ",-1))]),_:1})),f.value.length===0?(d(),x(U,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:s(()=>[o(_,{name:"bookmark_border",size:"64px",color:"grey-5",class:"q-mb-md"}),a[4]||(a[4]=i("div",{class:"text-h6 text-grey-7 q-mb-sm"},"No Saved Routes",-1)),a[5]||(a[5]=i("div",{class:"text-body2 text-grey-6 q-mb-md"}," Save your favorite routes for offline access ",-1)),o(P,{color:"primary",label:"Find Routes",onClick:a[0]||(a[0]=l=>u.$router.push("/"))})]),_:1})):(d(),B("div",Ce,[(d(!0),B(le,null,ce(f.value,l=>(d(),x(U,{key:l.id,class:"route-card",bordered:""},{default:s(()=>[o(J,null,{default:s(()=>[i("div",Re,[i("div",$e,[i("div",Qe,g(l.name),1),i("div",Ie,g(l.description),1),i("div",Oe,[o(T,{dense:"",icon:"route",color:"primary","text-color":"white",size:"sm"},{default:s(()=>[m(g(l.distance||"N/A"),1)]),_:2},1024),o(T,{dense:"",icon:"schedule",color:"secondary","text-color":"white",size:"sm"},{default:s(()=>[m(g(l.duration||"N/A"),1)]),_:2},1024),L(y)?O("",!0):(d(),x(T,{key:0,dense:"",icon:"cloud_off",color:"warning","text-color":"white",size:"sm"},{default:s(()=>[...a[6]||(a[6]=[m(" Cached ",-1)])]),_:1}))])]),i("div",Be,[o(me,{flat:"",round:"",dense:"",icon:"more_vert"},{default:s(()=>[o(ve,null,{default:s(()=>[W((d(),x(V,{clickable:"",onClick:z=>e(l)},{default:s(()=>[o(Q,{avatar:""},{default:s(()=>[o(_,{name:"visibility"})]),_:1}),o(Q,null,{default:s(()=>[...a[7]||(a[7]=[m("View Route",-1)])]),_:1})]),_:1},8,["onClick"])),[[j]]),W((d(),x(V,{clickable:"",onClick:z=>n(l)},{default:s(()=>[o(Q,{avatar:""},{default:s(()=>[o(_,{name:"share"})]),_:1}),o(Q,null,{default:s(()=>[...a[8]||(a[8]=[m("Share",-1)])]),_:1})]),_:1},8,["onClick"])),[[j]]),o(H),W((d(),x(V,{clickable:"",onClick:z=>c(l)},{default:s(()=>[o(Q,{avatar:""},{default:s(()=>[o(_,{name:"delete",color:"negative"})]),_:1}),o(Q,null,{default:s(()=>[...a[9]||(a[9]=[m("Remove",-1)])]),_:1})]),_:1},8,["onClick"])),[[j]])]),_:2},1024)]),_:2},1024)])])]),_:2},1024),o(H),o(J,{class:"q-pt-sm"},{default:s(()=>[i("div",Ne,[i("div",ze,[o(_,{name:"place",size:"16px"}),m(" From: "+g(l.origin||"Unknown"),1)]),i("div",Ae,[o(_,{name:"place",size:"16px"}),m(" To: "+g(l.destination||"Unknown"),1)]),l.cachedAt?(d(),B("div",Me,[o(_,{name:"update",size:"16px"}),m(" Cached: "+g(E(l.cachedAt)),1)])):O("",!0)])]),_:2},1024)]),_:2},1024))),128))])),f.value.length>0?(d(),B("div",De,[o(P,{flat:"",color:"negative",label:"Clear All Cached Routes",icon:"delete_sweep",onClick:b})])):O("",!0),o(U,{flat:"",bordered:"",class:"q-mt-lg"},{default:s(()=>[o(J,null,{default:s(()=>[a[10]||(a[10]=i("div",{class:"text-subtitle2 text-weight-medium q-mb-sm"}," Storage Usage ",-1)),v.value?(d(),B("div",Ee,[o(pe,{value:v.value.percentageUsed/100,color:"primary",class:"q-mb-sm",size:"20px"},{default:s(()=>[i("div",Fe,[i("div",Le,g(v.value.percentageUsed)+"% used ",1)])]),_:1},8,["value"]),i("div",Pe,g(v.value.usageInMB)+" MB of "+g(v.value.quotaInMB)+" MB used ",1)])):O("",!0)]),_:1})]),_:1})])])]),_:1}))}},tt=ne(Ue,[["__scopeId","data-v-5dc4c41e"]]);export{tt as default};
