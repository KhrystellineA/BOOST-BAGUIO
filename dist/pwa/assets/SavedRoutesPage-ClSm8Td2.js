import{k as H,r as C,d as G,G as j,H as Y,_ as K,u as X,y as h,o as c,w as s,p as a,z as S,m as R,n as t,v as u,A as v,t as f,x as D,Q as F,a3 as L,F as Z,q as ee,a4 as U,s as J,B as V}from"./index-BNMNkKPK.js";import{Q as te}from"./QTooltip-HxQ9Wq6G.js";import{Q as oe}from"./QBanner-BmaW9FEh.js";import{Q as W}from"./QChip-DdJtPbRF.js";import{Q as P,a as w}from"./QItem-DbSoALj4.js";import{Q as se}from"./QList-CPQTSOas.js";import{Q as ae}from"./QBtnDropdown-OgaoLcvi.js";import{Q as re}from"./QLinearProgress-DAX682LA.js";import{Q as ne}from"./QPage-DjjICR0a.js";import{C as T}from"./ClosePopup-DDK61RyB.js";import{u as ie}from"./use-quasar-C3LJSxmj.js";import"./position-engine-DFO69afB.js";import"./selection-61_R8QJt.js";import"./QMenu-C81fWRT3.js";function le(){const M=H(),_=C(navigator.onLine),n=C([]),g=()=>{_.value=navigator.onLine,_.value&&n.value.length>0&&b()},N=G(()=>M.isPremium&&!_.value),$=async e=>{if(!M.isPremium)return!1;try{const r=JSON.parse(localStorage.getItem("cachedRoutes")||"[]"),d=r.findIndex(y=>y.id===e.id);return d>=0?r[d]={...e,cachedAt:new Date().toISOString()}:r.push({...e,cachedAt:new Date().toISOString()}),r.length>50&&(r.sort((y,E)=>new Date(E.cachedAt)-new Date(y.cachedAt)),r.length=50),localStorage.setItem("cachedRoutes",JSON.stringify(r)),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_ROUTE",payload:e}),!0}catch(r){return console.error("Error caching route:",r),!1}},x=()=>{try{return JSON.parse(localStorage.getItem("cachedRoutes")||"[]")}catch(e){return console.error("Error getting cached routes:",e),[]}},B=e=>x().find(d=>d.id===e),m=e=>{try{const d=x().filter(y=>y.id!==e);return localStorage.setItem("cachedRoutes",JSON.stringify(d)),!0}catch(r){return console.error("Error removing cached route:",r),!1}},k=()=>{try{return localStorage.removeItem("cachedRoutes"),!0}catch(e){return console.error("Error clearing cached routes:",e),!1}},p=e=>{n.value.push({...e,timestamp:Date.now()}),localStorage.setItem("offlineQueue",JSON.stringify(n.value))},b=async()=>{const e=[...n.value];for(const r of e)try{r.type==="favorite"&&await fetch(r.url,{method:r.method,body:JSON.stringify(r.data),headers:{"Content-Type":"application/json"}}),n.value=n.value.filter(d=>d.timestamp!==r.timestamp)}catch(d){console.error("Error processing offline request:",d)}localStorage.setItem("offlineQueue",JSON.stringify(n.value))},q=async()=>{if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{usage:e.usage,quota:e.quota,usageInMB:(e.usage/(1024*1024)).toFixed(2),quotaInMB:(e.quota/(1024*1024)).toFixed(2),percentageUsed:(e.usage/e.quota*100).toFixed(2)}}return null},Q=async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/service-worker.js");return console.log("Service Worker registered:",e),e}catch(e){return console.error("Service Worker registration failed:",e),null}return null};return j(()=>{window.addEventListener("online",g),window.addEventListener("offline",g);try{const e=localStorage.getItem("offlineQueue");e&&(n.value=JSON.parse(e))}catch(e){console.error("Error loading offline queue:",e)}Q()}),Y(()=>{window.removeEventListener("online",g),window.removeEventListener("offline",g)}),{isOnline:_,canUseOffline:N,offlineQueue:n,cacheRouteData:$,getCachedRoutes:x,getCachedRoute:B,removeCachedRoute:m,clearAllCachedRoutes:k,queueForOnline:p,getCacheSize:q,registerServiceWorker:Q}}const ce={class:"row justify-center"},de={class:"col-12 col-md-10 col-lg-8"},ue={class:"row items-center q-mb-md"},fe={class:"col"},me={class:"text-h5 text-weight-bold"},ve={class:"text-caption text-grey-7"},ge={class:"col-auto"},pe={key:2,class:"q-gutter-md"},he={class:"row items-start"},ye={class:"col"},_e={class:"text-h6 text-weight-medium q-mb-xs"},we={class:"text-body2 text-grey-7 q-mb-sm"},xe={class:"row q-gutter-xs"},ke={class:"col-auto"},Se={class:"text-caption text-grey-7"},Re={class:"q-mb-xs"},Ce={class:"q-mb-xs"},be={key:0},qe={key:3,class:"q-mt-lg text-center"},Qe={key:0},Ie={class:"absolute-full flex flex-center"},Oe={class:"text-white text-caption"},Ae={class:"text-caption text-grey-7"},Me={__name:"SavedRoutesPage",setup(M){const _=X(),n=ie(),{isOnline:g,getCachedRoutes:N,removeCachedRoute:$,clearAllCachedRoutes:x,getCacheSize:B}=le(),m=C([]),k=C(!1),p=C(null);j(async()=>{await b(),await q()});const b=async()=>{k.value=!0;try{m.value=N()}catch{n.notify({type:"negative",message:"Failed to load saved routes",position:"top"})}finally{k.value=!1}},q=async()=>{p.value=await B()},Q=async()=>{await b(),await q(),n.notify({type:"positive",message:"Routes refreshed",position:"top"})},e=l=>{_.push(`/route/${l.id}`)},r=async l=>{if(navigator.share)try{await navigator.share({title:l.name,text:l.description,url:window.location.origin+`/route/${l.id}`})}catch{console.log("Share cancelled")}else{const o=window.location.origin+`/route/${l.id}`;await navigator.clipboard.writeText(o),n.notify({type:"positive",message:"Route link copied to clipboard",position:"top"})}},d=l=>{n.dialog({title:"Remove Route",message:`Remove "${l.name}" from saved routes?`,cancel:!0,persistent:!0}).onOk(()=>{$(l.id)?(m.value=m.value.filter(i=>i.id!==l.id),n.notify({type:"positive",message:"Route removed",position:"top"})):n.notify({type:"negative",message:"Failed to remove route",position:"top"})})},y=()=>{n.dialog({title:"Clear All Routes",message:"This will remove all cached routes. Continue?",cancel:!0,persistent:!0,ok:{color:"negative",label:"Clear All"}}).onOk(()=>{x()?(m.value=[],n.notify({type:"positive",message:"All routes cleared",position:"top"})):n.notify({type:"negative",message:"Failed to clear routes",position:"top"})})},E=l=>{const o=new Date(l),I=new Date-o,O=Math.floor(I/6e4);if(O<1)return"Just now";if(O<60)return`${O} min ago`;const A=Math.floor(O/60);if(A<24)return`${A} hour${A>1?"s":""} ago`;const z=Math.floor(A/24);return z<7?`${z} day${z>1?"s":""} ago`:o.toLocaleDateString()};return(l,o)=>(c(),h(ne,{class:"q-pa-md"},{default:s(()=>[a("div",ce,[a("div",de,[a("div",ue,[a("div",fe,[a("div",me,[t(v,{name:"bookmark",color:"primary",size:"28px",class:"q-mr-sm"}),o[1]||(o[1]=u(" Saved Routes ",-1))]),a("div",ve,f(D(g)?"Online":"Offline Mode")+" â€¢ "+f(m.value.length)+" routes cached ",1)]),a("div",ge,[t(F,{flat:"",round:"",icon:"refresh",onClick:Q,loading:k.value},{default:s(()=>[t(te,null,{default:s(()=>[...o[2]||(o[2]=[u("Refresh",-1)])]),_:1})]),_:1},8,["loading"])])]),D(g)?S("",!0):(c(),h(oe,{key:0,class:"bg-warning text-white q-mb-md",rounded:""},{avatar:s(()=>[t(v,{name:"cloud_off"})]),default:s(()=>[o[3]||(o[3]=u(" You're offline. Showing cached routes only. ",-1))]),_:1})),m.value.length===0?(c(),h(L,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:s(()=>[t(v,{name:"bookmark_border",size:"64px",color:"grey-5",class:"q-mb-md"}),o[4]||(o[4]=a("div",{class:"text-h6 text-grey-7 q-mb-sm"},"No Saved Routes",-1)),o[5]||(o[5]=a("div",{class:"text-body2 text-grey-6 q-mb-md"}," Save your favorite routes for offline access ",-1)),t(F,{color:"primary",label:"Find Routes",onClick:o[0]||(o[0]=i=>l.$router.push("/"))})]),_:1})):(c(),R("div",pe,[(c(!0),R(Z,null,ee(m.value,i=>(c(),h(L,{key:i.id,class:"route-card",bordered:""},{default:s(()=>[t(U,null,{default:s(()=>[a("div",he,[a("div",ye,[a("div",_e,f(i.name),1),a("div",we,f(i.description),1),a("div",xe,[t(W,{dense:"",icon:"route",color:"primary","text-color":"white",size:"sm"},{default:s(()=>[u(f(i.distance||"N/A"),1)]),_:2},1024),t(W,{dense:"",icon:"schedule",color:"secondary","text-color":"white",size:"sm"},{default:s(()=>[u(f(i.duration||"N/A"),1)]),_:2},1024),D(g)?S("",!0):(c(),h(W,{key:0,dense:"",icon:"cloud_off",color:"warning","text-color":"white",size:"sm"},{default:s(()=>[...o[6]||(o[6]=[u(" Cached ",-1)])]),_:1}))])]),a("div",ke,[t(ae,{flat:"",round:"",dense:"",icon:"more_vert"},{default:s(()=>[t(se,null,{default:s(()=>[J((c(),h(P,{clickable:"",onClick:I=>e(i)},{default:s(()=>[t(w,{avatar:""},{default:s(()=>[t(v,{name:"visibility"})]),_:1}),t(w,null,{default:s(()=>[...o[7]||(o[7]=[u("View Route",-1)])]),_:1})]),_:1},8,["onClick"])),[[T]]),J((c(),h(P,{clickable:"",onClick:I=>r(i)},{default:s(()=>[t(w,{avatar:""},{default:s(()=>[t(v,{name:"share"})]),_:1}),t(w,null,{default:s(()=>[...o[8]||(o[8]=[u("Share",-1)])]),_:1})]),_:1},8,["onClick"])),[[T]]),t(V),J((c(),h(P,{clickable:"",onClick:I=>d(i)},{default:s(()=>[t(w,{avatar:""},{default:s(()=>[t(v,{name:"delete",color:"negative"})]),_:1}),t(w,null,{default:s(()=>[...o[9]||(o[9]=[u("Remove",-1)])]),_:1})]),_:1},8,["onClick"])),[[T]])]),_:2},1024)]),_:2},1024)])])]),_:2},1024),t(V),t(U,{class:"q-pt-sm"},{default:s(()=>[a("div",Se,[a("div",Re,[t(v,{name:"place",size:"16px"}),u(" From: "+f(i.origin||"Unknown"),1)]),a("div",Ce,[t(v,{name:"place",size:"16px"}),u(" To: "+f(i.destination||"Unknown"),1)]),i.cachedAt?(c(),R("div",be,[t(v,{name:"update",size:"16px"}),u(" Cached: "+f(E(i.cachedAt)),1)])):S("",!0)])]),_:2},1024)]),_:2},1024))),128))])),m.value.length>0?(c(),R("div",qe,[t(F,{flat:"",color:"negative",label:"Clear All Cached Routes",icon:"delete_sweep",onClick:y})])):S("",!0),t(L,{flat:"",bordered:"",class:"q-mt-lg"},{default:s(()=>[t(U,null,{default:s(()=>[o[10]||(o[10]=a("div",{class:"text-subtitle2 text-weight-medium q-mb-sm"}," Storage Usage ",-1)),p.value?(c(),R("div",Qe,[t(re,{value:p.value.percentageUsed/100,color:"primary",class:"q-mb-sm",size:"20px"},{default:s(()=>[a("div",Ie,[a("div",Oe,f(p.value.percentageUsed)+"% used ",1)])]),_:1},8,["value"]),a("div",Ae,f(p.value.usageInMB)+" MB of "+f(p.value.quotaInMB)+" MB used ",1)])):S("",!0)]),_:1})]),_:1})])])]),_:1}))}},je=K(Me,[["__scopeId","data-v-007f39ec"]]);export{je as default};
